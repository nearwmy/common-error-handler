(function(t,r){typeof exports=="object"&&typeof module!="undefined"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(t=typeof globalThis!="undefined"?globalThis:t||self,r(t.lib={}))})(this,function(t){"use strict";var T=Object.defineProperty;var A=(t,r,i)=>r in t?T(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i;var s=(t,r,i)=>(A(t,typeof r!="symbol"?r+"":r,i),i);var D={COMMON_CODES:{NETWORK_ERROR:"Network Error",TIMEOUT_ABORTED:"ECONNABORTED",INVALID_TOKEN:"INVALID_TOKEN",INVALID_TOKEN_CODE:413},EDAM_CODES:{PERMISSION_DENIED:3,INVALID_AUTH:8,AUTH_EXPIRED:9},GRPC_CODES:{CONTENT_lOADED_FAILED:11003,PERMISSION_DENIED:11004,INTERNAL_ERROR:11009,ACCOUNT_DEACTIVATION:11010,AUTH_EXPIRED:11005,SENSITIVE_CONTENT:11008,TRAFFIC_EXCEEDED:22005,SERVER_ERROR:22006,TOO_FREQUENT:11006,REACHED_LIMIT:11007,FORMAT_ERROR:22222}};class u extends Error{constructor(n){super();s(this,"code","");s(this,"message","");this.code=n.code,this.message=n.message}}s(u,"type","edam");class R extends Error{constructor(n){super();s(this,"code","");s(this,"message","");this.code=n.code,this.message=n.message}}s(R,"type","grpc");class g extends Error{constructor(n){super();s(this,"code","");s(this,"message","");this.code=n.code,this.message=n.message}}s(g,"type","restful");var _={EdamError:u,GrpcError:R,RestfulError:g};const O=Symbol();let d=null;const H=l=>{if(l instanceof Error)throw Error;return l};class E{constructor(e){s(this,"configHandlers");s(this,"finalHandler",H);if(e!==O)throw new Error("ERROR_HANDLER: can not create a ErrorHandler instance");this.configHandlers=new Map}static getInstance(){return d===null&&(d=new E(O)),d}registerHandlers(e){const n=Object.keys(e);for(let o=0;o<n.length;o++)this.configHandlers.set(n[o],e[n[o]])}registerFinalHandler(e){if(typeof e=="function")this.finalHandler=e;else throw new Error("ERROR_HANDLER: final handler must be function")}unregisterHandlers(e){for(let n=0;n++;n<e.length)this.configHandlers.delete(e[n])}unregisterFinalHandler(){this.finalHandler=H}getConfigHandlers(){return this.configHandlers}getFinalHandler(){return this.finalHandler}assert(e,n){const o=this.configHandlers.get(e);if(o){const{condition:a}=o;return a(n)}else return console.warn(`ERROR_HANDLER: ${e} is not found in configHandlers`),!1}handler(e){if(e!=null){const n=f=>{try{typeof this.finalHandler=="function"&&this.finalHandler(f)}catch(c){console.warn(`occur an error in finalHandler handler
`,c)}};let o=!1,a=0;Array.from(this.configHandlers).forEach(f=>{const c=f[1];if(c.condition(e)){let h=!0;const N={stopPropagation(){h=!1}};try{c.handler(e,N)}catch(I){n(I)}o=!0,h&&a++}}),console.log("needBubble====",a),console.log("handled=====",o),(!o||a>0)&&n(e)}}}t.RequestError=_,t.default=E,t.errorCodes=D,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
